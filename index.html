<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
    <head>
        <title>untitled</title>
        <meta http-equiv="content-type" content="text/html;charset=utf-8" />
        <script type="text/javascript" src="http://code.jquery.com/jquery-1.4.2.min.js"></script>
        <script type="text/javascript" src="assets/javascript/flot/excanvas.min.js"></script>
        <script type="text/javascript" src="assets/javascript/flot/jquery.flot.min.js"></script>
        <script type="text/javascript" src="assets/javascript/javascriptrrd/binaryXHR.js"></script>
        <script type="text/javascript" src="assets/javascript/javascriptrrd/rrdFile.js"></script>
        <script type="text/javascript" src="assets/javascript/javascriptrrd/rrdFlotSupport.js"></script>
        <script type="text/javascript" src="assets/javascript/MochiKit/Base.js"></script>
        <script type="text/javascript" src="assets/javascript/MochiKit/Async.js"></script>
        <script type="text/javascript">
        var rrd, err;
        function downloadRRD(url) {
            var d = new MochiKit.Async.Deferred();
            $.ajax({
                url: url,
                dataType: 'text',
                beforeSend: function(request) {
                    try {
                        request.overrideMimeType('text/plain; charset=x-user-defined');
                    } catch(e) {
                        // IE doesn't support overrideMimeType
                    }
                },
                success: function(data) {
                    try {
                        d.callback(new RRDFile(new BinaryFile(data)));
                    } catch(e) {
                        d.errback(e);
                    }
                },
                error: function(xhr, textStatus, errorThrown) {
                    // Special case for IE which handles binary data slightly
                    // differently.
                    if(textStatus == 'parsererror') {
                        if (typeof xhr.responseBody != 'undefined') {
                            return this.success(xhr.responseBody);
                        }
                    }
                    d.errback(new Error(xhr.status));
                }
            });
            return d;
        }

        $(function() {
            var urls = [
                'data/localhost/interface/if_packets-eth0.rrd',
                'data/localhost/interface/if_packets-lo.rrd'
            ];

            var results = []
            jQuery.each(urls, function(i, url) {
                var d = downloadRRD(url);
                results.push(d);
            });

            dl = new MochiKit.Async.DeferredList(results);

            dl.addCallbacks(
                function(results) {
                    data = [];

                    jQuery.each(results, function(i, result) {
                        rrd = result[1];
                        var series = rrdRRA2FlotObj(rrd, 3, [0, 1], 1, 1);
                        data = data.concat(series.data);
                    });

                    options = {
                        xaxis: {
                            mode: "time"
                        }
                    };
                    var plot = $.plot($('.container'), data, options);
                },

                function(failure) {
                    err = failure;
                    $('.container').text('error: ' + failure.message);
                });
        });
        </script>
    </head>

    <body>
        <div class="container" style="width:100%; height:200px;"></div>
    </body>
</html>
